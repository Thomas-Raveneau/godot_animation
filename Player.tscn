[gd_scene load_steps=15 format=2]

[ext_resource path="res://PlayerModel.tscn" type="PackedScene" id=1]
[ext_resource path="res://assets/Player/idle.anim" type="Animation" id=2]
[ext_resource path="res://Camera.gd" type="Script" id=3]
[ext_resource path="res://assets/Player/Run.anim" type="Animation" id=4]
[ext_resource path="res://AnimationTree.gd" type="Script" id=5]
[ext_resource path="res://assets/Player/Jump.anim" type="Animation" id=6]

[sub_resource type="GDScript" id=1]
script/source = "extends KinematicBody

var camera

export var velocity = Vector3()

const GRAVITY = -9.8
const SPEED = 6
const ACCELERATION = 3
const DEACCELERATION = 5

func _ready():
	 pass

func _physics_process(delta):
	camera = $CameraTarget/Camera.get_global_transform()
	var is_moving = false
	var dir = Vector3()

	if(Input.is_action_pressed(\"move_forward\")):
		dir += -camera.basis[2]
		is_moving = true
	if(Input.is_action_pressed(\"move_backward\")):
		dir += camera.basis[2]
		is_moving = true
	if(Input.is_action_pressed(\"move_left\")):
		dir += -camera.basis[0]
		is_moving = true
	if(Input.is_action_pressed(\"move_right\")):
		dir += camera.basis[0]
		is_moving = true
	
	dir.y = 0
	dir = dir.normalized()
	
	
	velocity.y += delta * GRAVITY
	
	var hv = velocity
	hv.y = 0
	
	var new_pos = dir * SPEED
	var accel = DEACCELERATION
	
	if (dir.dot(hv) > 0):
		accel = ACCELERATION
	
	hv = hv.linear_interpolate(new_pos, accel * delta)
	
	velocity.x = hv.x
	velocity.z = hv.z 
	
	velocity = move_and_slide(velocity, Vector3(0, 1, 0))
	
	if (is_moving):
		var angle = atan2(hv.x, hv.z)
		var player_rot = self.get_rotation()
		
		player_rot.y = angle
		self.set_rotation(player_rot)

func handleInputs():
	pass
"

[sub_resource type="CapsuleShape" id=2]
radius = 0.626867
height = 0.945911

[sub_resource type="AnimationNodeBlend2" id=3]

[sub_resource type="AnimationNodeOneShot" id=4]
fadein_time = 0.2
sync = true

[sub_resource type="AnimationNodeAnimation" id=6]
animation = "idle"

[sub_resource type="AnimationNodeAnimation" id=7]
animation = "Jump"

[sub_resource type="AnimationNodeAnimation" id=8]
animation = "Run"

[sub_resource type="AnimationNodeBlendTree" id=9]
graph_offset = Vector2( -1169.35, 470.75 )
nodes/Blend2/node = SubResource( 3 )
nodes/Blend2/position = Vector2( -420, 420 )
nodes/OneShot/node = SubResource( 4 )
nodes/OneShot/position = Vector2( -40, 580 )
nodes/idle_animation/node = SubResource( 6 )
nodes/idle_animation/position = Vector2( -760, 360 )
nodes/jump_animation/node = SubResource( 7 )
nodes/jump_animation/position = Vector2( -360, 660 )
nodes/output/position = Vector2( 480, 580 )
nodes/run_animation/node = SubResource( 8 )
nodes/run_animation/position = Vector2( -760, 560 )
node_connections = [ "output", 0, "OneShot", "OneShot", 0, "Blend2", "OneShot", 1, "jump_animation", "Blend2", 0, "idle_animation", "Blend2", 1, "run_animation" ]

[node name="Player" type="KinematicBody"]
script = SubResource( 1 )

[node name="Player" parent="." instance=ExtResource( 1 )]

[node name="CollisionShape" type="CollisionShape" parent="."]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 1.09981, 0 )
shape = SubResource( 2 )

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource( 9 )
anim_player = NodePath("../AnimationPlayer")
active = true
parameters/Blend2/blend_amount = 0.0
parameters/OneShot/active = false
script = ExtResource( 5 )

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
root_node = NodePath("../Player/RootNode")
anims/Jump = ExtResource( 6 )
anims/Run = ExtResource( 4 )
anims/idle = ExtResource( 2 )

[node name="CameraTarget" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.83531, 0 )

[node name="Camera" type="Camera" parent="CameraTarget"]
transform = Transform( -1, 0, -8.74228e-08, -3.36469e-08, 0.922969, 0.384875, 8.06885e-08, 0.384875, -0.922969, 0, 0.599719, -2.40856 )
current = true
fov = 60.2171
script = ExtResource( 3 )

[editable path="Player"]
